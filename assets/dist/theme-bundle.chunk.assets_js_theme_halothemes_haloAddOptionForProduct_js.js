"use strict";
(self["webpackChunkbigcommerce_nimo"] = self["webpackChunkbigcommerce_nimo"] || []).push([["assets_js_theme_halothemes_haloAddOptionForProduct_js"],{

/***/ "./assets/js/theme/halothemes/haloAddOptionForProduct.js":
/*!***************************************************************!*\
  !*** ./assets/js/theme/halothemes/haloAddOptionForProduct.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* export default binding */ __WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.min.js");
/* harmony default export */ function __WEBPACK_DEFAULT_EXPORT__(context, wrapper) {
  if (context.themeSettings.haloAddOptionForProduct == true) {
    var callProductOption = function callProductOption() {
      product_class.each(function (index, element) {
        var productId = $(element).data("product-id");
        if (!$(element).find('[data-product-attribute="swatch"]').children().length) {
          list.push(productId.toString());
        }
      });
      list = uniqueArray(list);
      if (list.length > 0) {
        getProductOption(list).then(function (data) {
          renderOption(data);
          $.each(list, function (idx, item) {
            var arr = {},
              productId = list[idx];
            var thisProduct = product_wrapper.find('.card:not(.is-loaded) .card-option-' + productId + ':not(.is-loaded):eq(0)');
            thisProduct.find('.form-option-swatch').each(function (index, element) {
              var txt = $(element).data('product-swatch-value');
              thisProduct.find('.card-name').show();
              if (arr[txt]) {
                $(element).remove();
              } else {
                arr[txt] = true;
              }
            });
            if (thisProduct.find('.form-option-swatch').length > 5) {
              var countMoreOption = thisProduct.find('.form-option-swatch').length - 5,
                productLink = product_wrapper.find('[data-product-id="' + productId + '"]').find('.card-title').attr('href');
              thisProduct.find('.form-option-swatch').each(function (index, element) {
                if (index >= 5) {
                  $(element).remove();
                }
              });
              if (thisProduct.find('.form-field .showmore').length < 1) {
                thisProduct.find('.form-field').append('<a href="' + productLink + '" class="form-option form-option-swatch halo-fadeIn showmore">+' + countMoreOption + '</a>');
              }
            }
            thisProduct.addClass('is-loaded').closest('.card').addClass('is-loaded');
          });
        });
      }
    };
    var getProductOption = function getProductOption(list) {
      return fetch('/graphql', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
        },
        body: JSON.stringify({
          query: "\n                        query SeveralProductsByID {\n                            site {\n                                products(entityIds: [" + list + "], first: 50) {\n                                    edges {\n                                        node {\n                                            entityId\n                                            name\n                                            defaultImage{\n                                                urlOriginal\n                                            }\n                                            variants(first: 250){\n                                                edges{\n                                                    node{\n                                                        entityId\n                                                        defaultImage{\n                                                            urlOriginal\n                                                        }\n                                                        productOptions(first: 50) {\n                                                            edges {\n                                                                node {\n                                                                    entityId\n                                                                    displayName\n                                                                    isRequired\n                                                                    ... on MultipleChoiceOption {\n                                                                        displayStyle\n                                                                        values {\n                                                                            edges {\n                                                                                node {\n                                                                                    entityId\n                                                                                    label\n                                                                                    isDefault\n                                                                                    ... on SwatchOptionValue {\n                                                                                        hexColors\n                                                                                        imageUrl(width: 150)\n                                                                                    }\n                                                                                }\n                                                                            }\n                                                                        }\n                                                                    }\n                                                                }\n                                                            }\n                                                        }\n                                                    }\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    "
        })
      }).then(function (res) {
        return res.json();
      }).then(function (res) {
        return res.data;
      });
    };
    var renderOption = function renderOption(data) {
      var aFilter = data.site.products.edges;
      $.each(aFilter, function (index, element) {
        var productId = aFilter[index].node.entityId,
          productImage,
          productFieldColor = product_wrapper.find('.card-option-' + productId + ':not(.is-loaded):eq(0) .form-field'),
          aFilter2 = aFilter[index].node.variants.edges;
        if (aFilter[index].node.defaultImage) {
          productImage = aFilter[index].node.defaultImage.urlOriginal;
        } else {
          productImage = 'https://cdn11.bigcommerce.com/s-ol6dayxf7q/stencil/d960f210-86dd-0138-e71d-0242ac110008/e/a2941d20-8b64-0138-e78d-0242ac110013/img/ProductDefault.gif';
        }
        $.each(aFilter2, function (idx, el) {
          var variantImage,
            aFilter3 = aFilter2[idx].node.productOptions.edges;
          if (aFilter2[idx].node.defaultImage) {
            variantImage = aFilter2[idx].node.defaultImage.urlOriginal;
          }
          if (variantImage === undefined || variantImage === null) {
            variantImage = productImage;
          }
          var aFilter4 = aFilter3.filter(function (item) {
            return item.node.displayStyle === 'Swatch';
          });
          if (aFilter4.length > 0) {
            var aFilter5 = aFilter4[0].node.values.edges;
            $.each(aFilter5, function (idx, element) {
              var titleVar = aFilter5[idx].node.label,
                idVar = aFilter5[idx].node.entityId,
                lengthColorVar = aFilter5[idx].node.hexColors.length,
                color1 = aFilter5[idx].node.hexColors[0],
                color2 = aFilter5[idx].node.hexColors[1],
                color3 = aFilter5[idx].node.hexColors[2],
                img = aFilter5[idx].node.imageUrl;
              if (lengthColorVar == 2) {
                productFieldColor.append('<label class="form-option form-option-swatch halo-fadeIn two-colors" data-image ="' + variantImage + '" data-product-swatch-value="' + idVar + '" data-title="' + titleVar + '"><span class="form-option-tooltip f-size-tiny d-none">' + titleVar + '</span><span class="form-option-variant form-option-variant--color form-option-variant--color2" title="' + titleVar + '"><span class="form-option-variant-wrapper"><span style="background-color:' + color1 + ';border: none;left: -1px;"></span><span style="background-color:' + color2 + ';border: none;"></span></span></span></label>');
              } else if (lengthColorVar === 3) {
                productFieldColor.append('<label class="form-option form-option-swatch halo-fadeIn three-colors two-colors" data-image ="' + variantImage + '" data-product-swatch-value="' + idVar + '" data-title="' + titleVar + '"><span class="form-option-tooltip f-size-tiny d-none">' + titleVar + '</span><span class="form-option-variant form-option-variant--color form-option-variant--color2" title="' + titleVar + '"><span class="form-option-variant-wrapper"><span style="background-color:' + color1 + '"></span><span style="background-color:' + color2 + '"></span><span style="background-color:' + color3 + '"></span></span></span></label>');
              } else if (Boolean(color1)) {
                productFieldColor.append('<label class="form-option form-option-swatch halo-fadeIn" data-image ="' + variantImage + '"  data-product-swatch-value="' + idVar + '" data-title="' + titleVar + '"><span class="form-option-tooltip f-size-tiny d-none">' + titleVar + '</span><span class="form-option-variant form-option-variant--color" title="' + titleVar + '" style="background-color: ' + color1 + '"></span></label>');
              } else if (Boolean(img)) {
                productFieldColor.append('<label class="form-option form-option-swatch halo-fadeIn " data-image ="' + variantImage + '" data-product-swatch-value="' + idVar + '" data-title="' + titleVar + '"><span class="form-option-tooltip f-size-tiny d-none">' + titleVar + '</span><span class="form-option-variant form-option-variant--pattern" title="' + titleVar + '" style="background-image: url(' + img + ')"></span></label>');
              }
            });
          } else {
            productFieldColor.remove();
          }
        });
      });
    };
    var uniqueArray = function uniqueArray(list) {
      var result = [];
      $.each(list, function (index, element) {
        if ($.inArray(element, result) == -1) {
          result.push(element);
        }
      });
      return result;
    };
    var token = context.token,
      product_wrapper = $('#' + wrapper),
      product_class = product_wrapper.find('.card:not(.is-loaded)');
    var list = [];
    callProductOption();
    product_wrapper.on('beforeChange', function () {
      callProductOption();
    });
  }
}

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhlbWUtYnVuZGxlLmNodW5rLmFzc2V0c19qc190aGVtZV9oYWxvdGhlbWVzX2hhbG9BZGRPcHRpb25Gb3JQcm9kdWN0X2pzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkJBQWUsb0NBQVNBLE9BQU8sRUFBRUMsT0FBTyxFQUFFO0VBQ3RDLElBQUlELE9BQU8sQ0FBQ0UsYUFBYSxDQUFDQyx1QkFBdUIsSUFBSSxJQUFJLEVBQUU7SUFBQSxJQU05Q0MsaUJBQWlCLEdBQTFCLFNBQVNBLGlCQUFpQkEsQ0FBQSxFQUFHO01BQ3pCQyxhQUFhLENBQUNDLElBQUksQ0FBQyxVQUFDQyxLQUFLLEVBQUVDLE9BQU8sRUFBSztRQUNuQyxJQUFJQyxTQUFTLEdBQUdDLENBQUMsQ0FBQ0YsT0FBTyxDQUFDLENBQUNHLElBQUksQ0FBQyxZQUFZLENBQUM7UUFDN0MsSUFBRyxDQUFDRCxDQUFDLENBQUNGLE9BQU8sQ0FBQyxDQUFDSSxJQUFJLENBQUMsbUNBQW1DLENBQUMsQ0FBQ0MsUUFBUSxDQUFDLENBQUMsQ0FBQ0MsTUFBTSxFQUFDO1VBQ3ZFQyxJQUFJLENBQUNDLElBQUksQ0FBQ1AsU0FBUyxDQUFDUSxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ25DO01BQ0osQ0FBQyxDQUFDO01BRUZGLElBQUksR0FBR0csV0FBVyxDQUFDSCxJQUFJLENBQUM7TUFFeEIsSUFBR0EsSUFBSSxDQUFDRCxNQUFNLEdBQUcsQ0FBQyxFQUFDO1FBQ2ZLLGdCQUFnQixDQUFDSixJQUFJLENBQUMsQ0FBQ0ssSUFBSSxDQUFDLFVBQUFULElBQUksRUFBSTtVQUNoQ1UsWUFBWSxDQUFDVixJQUFJLENBQUM7VUFFbEJELENBQUMsQ0FBQ0osSUFBSSxDQUFDUyxJQUFJLEVBQUUsVUFBQ08sR0FBRyxFQUFFQyxJQUFJLEVBQUs7WUFDeEIsSUFBSUMsR0FBRyxHQUFHLENBQUMsQ0FBQztjQUNSZixTQUFTLEdBQUdNLElBQUksQ0FBQ08sR0FBRyxDQUFDO1lBQ3pCLElBQUlHLFdBQVcs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LGlCQUFpQixDQUFDeEIsTUFBTSxDQUFDLENBQUM7VUFDOUI7UUFDSixDQUFDLENBQUM7TUFDTixDQUFDLENBQUM7SUFDTixDQUFDO0lBQUEsSUFFUVgsV0FBVyxHQUFwQixTQUFTQSxXQUFXQSxDQUFDSCxJQUFJLEVBQUU7TUFDdkIsSUFBSWdFLE1BQU0sR0FBRyxFQUFFO01BRWZyRSxDQUFDLENBQUNKLElBQUksQ0FBQ1MsSUFBSSxFQUFFLFVBQUNSLEtBQUssRUFBRUMsT0FBTyxFQUFLO1FBQzdCLElBQUlFLENBQUMsQ0FBQ3NFLE9BQU8sQ0FBQ3hFLE9BQU8sRUFBRXVFLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFO1VBQ2xDQSxNQUFNLENBQUMvRCxJQUFJLENBQUNSLE9BQU8sQ0FBQztRQUN4QjtNQUNKLENBQUMsQ0FBQztNQUVGLE9BQU91RSxNQUFNO0lBQ2pCLENBQUM7SUFyTUQsSUFBTXhDLEtBQUssR0FBR3ZDLE9BQU8sQ0FBQ3VDLEtBQUs7TUFDdkJiLGVBQWUsR0FBR2hCLENBQUMsQ0FBQyxHQUFHLEdBQUNULE9BQU8sQ0FBQztNQUNoQ0ksYUFBYSxHQUFHcUIsZUFBZSxDQUFDZCxJQUFJLENBQUMsdUJBQXVCLENBQUM7SUFDakUsSUFBS0csSUFBSSxHQUFHLEVBQUU7SUFvTWRYLGlCQUFpQixDQUFDLENBQUM7SUFFbkJzQixlQUFlLENBQUN1RCxFQUFFLENBQUMsY0FBYyxFQUFFLFlBQVc7TUFDMUM3RSxpQkFBaUIsQ0FBQyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQztFQUNOO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iaWdjb21tZXJjZS1uaW1vLy4vYXNzZXRzL2pzL3RoZW1lL2hhbG90aGVtZXMvaGFsb0FkZE9wdGlvbkZvclByb2R1Y3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24oY29udGV4dCwgd3JhcHBlcikge1xyXG4gICAgaWYgKGNvbnRleHQudGhlbWVTZXR0aW5ncy5oYWxvQWRkT3B0aW9uRm9yUHJvZHVjdCA9PSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3QgdG9rZW4gPSBjb250ZXh0LnRva2VuLFxyXG4gICAgICAgICAgICBwcm9kdWN0X3dyYXBwZXIgPSAkKCcjJyt3cmFwcGVyKSxcclxuICAgICAgICAgICAgcHJvZHVjdF9jbGFzcyA9IHByb2R1Y3Rfd3JhcHBlci5maW5kKCcuY2FyZDpub3QoLmlzLWxvYWRlZCknKTtcclxuICAgICAgICB2YXIgIGxpc3QgPSBbXTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2FsbFByb2R1Y3RPcHRpb24oKSB7XHJcbiAgICAgICAgICAgIHByb2R1Y3RfY2xhc3MuZWFjaCgoaW5kZXgsIGVsZW1lbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBwcm9kdWN0SWQgPSAkKGVsZW1lbnQpLmRhdGEoXCJwcm9kdWN0LWlkXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYoISQoZWxlbWVudCkuZmluZCgnW2RhdGEtcHJvZHVjdC1hdHRyaWJ1dGU9XCJzd2F0Y2hcIl0nKS5jaGlsZHJlbigpLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5wdXNoKHByb2R1Y3RJZC50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBsaXN0ID0gdW5pcXVlQXJyYXkobGlzdCk7XHJcblxyXG4gICAgICAgICAgICBpZihsaXN0Lmxlbmd0aCA+IDApe1xyXG4gICAgICAgICAgICAgICAgZ2V0UHJvZHVjdE9wdGlvbihsaXN0KS50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlbmRlck9wdGlvbihkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGxpc3QsIChpZHgsIGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFyciA9IHt9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdElkID0gbGlzdFtpZHhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGhpc1Byb2R1Y3QgPSBwcm9kdWN0X3dyYXBwZXIuZmluZCgnLmNhcmQ6bm90KC5pcy1sb2FkZWQpIC5jYXJkLW9wdGlvbi0nK3Byb2R1Y3RJZCsnOm5vdCguaXMtbG9hZGVkKTplcSgwKScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1Byb2R1Y3QuZmluZCgnLmZvcm0tb3B0aW9uLXN3YXRjaCcpLmVhY2goKGluZGV4LCBlbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHh0ID0gJChlbGVtZW50KS5kYXRhKCdwcm9kdWN0LXN3YXRjaC12YWx1ZScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNQcm9kdWN0LmZpbmQoJy5jYXJkLW5hbWUnKS5zaG93KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyclt0eHRdKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJbdHh0XSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpc1Byb2R1Y3QuZmluZCgnLmZvcm0tb3B0aW9uLXN3YXRjaCcpLmxlbmd0aCA+IDUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50TW9yZU9wdGlvbiAgPSB0aGlzUHJvZHVjdC5maW5kKCcuZm9ybS1vcHRpb24tc3dhdGNoJykubGVuZ3RoIC0gNSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0TGluayA9IHByb2R1Y3Rfd3JhcHBlci5maW5kKCdbZGF0YS1wcm9kdWN0LWlkPVwiJytwcm9kdWN0SWQrJ1wiXScpLmZpbmQoJy5jYXJkLXRpdGxlJykuYXR0cignaHJlZicpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNQcm9kdWN0LmZpbmQoJy5mb3JtLW9wdGlvbi1zd2F0Y2gnKS5lYWNoKChpbmRleCwgZWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGluZGV4ID49IDUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXNQcm9kdWN0LmZpbmQoJy5mb3JtLWZpZWxkIC5zaG93bW9yZScpLmxlbmd0aCA8IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNQcm9kdWN0LmZpbmQoJy5mb3JtLWZpZWxkJykuYXBwZW5kKCc8YSBocmVmPVwiJytwcm9kdWN0TGluaysnXCIgY2xhc3M9XCJmb3JtLW9wdGlvbiBmb3JtLW9wdGlvbi1zd2F0Y2ggaGFsby1mYWRlSW4gc2hvd21vcmVcIj4rJytjb3VudE1vcmVPcHRpb24rJzwvYT4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1Byb2R1Y3RcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnaXMtbG9hZGVkJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jbG9zZXN0KCcuY2FyZCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2lzLWxvYWRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRQcm9kdWN0T3B0aW9uKGxpc3Qpe1xyXG4gICAgICAgICAgICByZXR1cm4gZmV0Y2goJy9ncmFwaHFsJywge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogJ0JlYXJlciAnICsgdG9rZW5cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICAgICAgcXVlcnk6IGBcclxuICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkgU2V2ZXJhbFByb2R1Y3RzQnlJRCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXRlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0cyhlbnRpdHlJZHM6IFtgK2xpc3QrYF0sIGZpcnN0OiA1MCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGdlcyB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHlJZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0SW1hZ2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybE9yaWdpbmFsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnRzKGZpcnN0OiAyNTApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGdlc3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGV7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5SWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0SW1hZ2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybE9yaWdpbmFsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RPcHRpb25zKGZpcnN0OiA1MCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGdlcyB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHlJZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNSZXF1aXJlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLiBvbiBNdWx0aXBsZUNob2ljZU9wdGlvbiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlTdHlsZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRnZXMge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHlJZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0RlZmF1bHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uIG9uIFN3YXRjaE9wdGlvblZhbHVlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhleENvbG9yc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VVcmwod2lkdGg6IDE1MClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGBcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICB9KS50aGVuKHJlcyA9PiByZXMuanNvbigpKS50aGVuKHJlcyA9PiByZXMuZGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW5kZXJPcHRpb24oZGF0YSl7XHJcbiAgICAgICAgICAgIHZhciBhRmlsdGVyID0gZGF0YS5zaXRlLnByb2R1Y3RzLmVkZ2VzO1xyXG5cclxuICAgICAgICAgICAgJC5lYWNoKGFGaWx0ZXIsIChpbmRleCwgZWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHByb2R1Y3RJZCA9IGFGaWx0ZXJbaW5kZXhdLm5vZGUuZW50aXR5SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdEltYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgIHByb2R1Y3RGaWVsZENvbG9yID0gcHJvZHVjdF93cmFwcGVyLmZpbmQoJy5jYXJkLW9wdGlvbi0nK3Byb2R1Y3RJZCsnOm5vdCguaXMtbG9hZGVkKTplcSgwKSAuZm9ybS1maWVsZCcpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFGaWx0ZXIyID0gYUZpbHRlcltpbmRleF0ubm9kZS52YXJpYW50cy5lZGdlcztcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmIChhRmlsdGVyW2luZGV4XS5ub2RlLmRlZmF1bHRJbWFnZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdEltYWdlID0gYUZpbHRlcltpbmRleF0ubm9kZS5kZWZhdWx0SW1hZ2UudXJsT3JpZ2luYWw7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdEltYWdlID0naHR0cHM6Ly9jZG4xMS5iaWdjb21tZXJjZS5jb20vcy1vbDZkYXl4ZjdxL3N0ZW5jaWwvZDk2MGYyMTAtODZkZC0wMTM4LWU3MWQtMDI0MmFjMTEwMDA4L2UvYTI5NDFkMjAtOGI2NC0wMTM4LWU3OGQtMDI0MmFjMTEwMDEzL2ltZy9Qcm9kdWN0RGVmYXVsdC5naWYnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAkLmVhY2goYUZpbHRlcjIsIChpZHgsIGVsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhcmlhbnRJbWFnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYUZpbHRlcjMgPSBhRmlsdGVyMltpZHhdLm5vZGUucHJvZHVjdE9wdGlvbnMuZWRnZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGFGaWx0ZXIyW2lkeF0ubm9kZS5kZWZhdWx0SW1hZ2Upe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50SW1hZ2UgPSBhRmlsdGVyMltpZHhdLm5vZGUuZGVmYXVsdEltYWdlLnVybE9yaWdpbmFsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYodmFyaWFudEltYWdlID09PSB1bmRlZmluZWQgfHwgdmFyaWFudEltYWdlID09PSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFudEltYWdlID0gcHJvZHVjdEltYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFGaWx0ZXI0ID0gYUZpbHRlcjMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLm5vZGUuZGlzcGxheVN0eWxlID09PSAnU3dhdGNoJztcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYUZpbHRlcjQubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhRmlsdGVyNSA9IGFGaWx0ZXI0WzBdLm5vZGUudmFsdWVzLmVkZ2VzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGFGaWx0ZXI1LCAoaWR4LCBlbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGl0bGVWYXIgPSBhRmlsdGVyNVtpZHhdLm5vZGUubGFiZWwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRWYXIgPSBhRmlsdGVyNVtpZHhdLm5vZGUuZW50aXR5SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoQ29sb3JWYXIgPSBhRmlsdGVyNVtpZHhdLm5vZGUuaGV4Q29sb3JzLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjEgPSBhRmlsdGVyNVtpZHhdLm5vZGUuaGV4Q29sb3JzWzBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yMiA9IGFGaWx0ZXI1W2lkeF0ubm9kZS5oZXhDb2xvcnNbMV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IzID0gYUZpbHRlcjVbaWR4XS5ub2RlLmhleENvbG9yc1syXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSBhRmlsdGVyNVtpZHhdLm5vZGUuaW1hZ2VVcmw7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGxlbmd0aENvbG9yVmFyID09IDIpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RGaWVsZENvbG9yLmFwcGVuZCgnPGxhYmVsIGNsYXNzPVwiZm9ybS1vcHRpb24gZm9ybS1vcHRpb24tc3dhdGNoIGhhbG8tZmFkZUluIHR3by1jb2xvcnNcIiBkYXRhLWltYWdlID1cIicrdmFyaWFudEltYWdlKydcIiBkYXRhLXByb2R1Y3Qtc3dhdGNoLXZhbHVlPVwiJytpZFZhcisnXCIgZGF0YS10aXRsZT1cIicrdGl0bGVWYXIrJ1wiPjxzcGFuIGNsYXNzPVwiZm9ybS1vcHRpb24tdG9vbHRpcCBmLXNpemUtdGlueSBkLW5vbmVcIj4nK3RpdGxlVmFyKyc8L3NwYW4+PHNwYW4gY2xhc3M9XCJmb3JtLW9wdGlvbi12YXJpYW50IGZvcm0tb3B0aW9uLXZhcmlhbnQtLWNvbG9yIGZvcm0tb3B0aW9uLXZhcmlhbnQtLWNvbG9yMlwiIHRpdGxlPVwiJyt0aXRsZVZhcisnXCI+PHNwYW4gY2xhc3M9XCJmb3JtLW9wdGlvbi12YXJpYW50LXdyYXBwZXJcIj48c3BhbiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6Jytjb2xvcjErJztib3JkZXI6IG5vbmU7bGVmdDogLTFweDtcIj48L3NwYW4+PHNwYW4gc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOicrY29sb3IyKyc7Ym9yZGVyOiBub25lO1wiPjwvc3Bhbj48L3NwYW4+PC9zcGFuPjwvbGFiZWw+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYobGVuZ3RoQ29sb3JWYXIgPT09IDMpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RGaWVsZENvbG9yLmFwcGVuZCgnPGxhYmVsIGNsYXNzPVwiZm9ybS1vcHRpb24gZm9ybS1vcHRpb24tc3dhdGNoIGhhbG8tZmFkZUluIHRocmVlLWNvbG9ycyB0d28tY29sb3JzXCIgZGF0YS1pbWFnZSA9XCInK3ZhcmlhbnRJbWFnZSsnXCIgZGF0YS1wcm9kdWN0LXN3YXRjaC12YWx1ZT1cIicraWRWYXIrJ1wiIGRhdGEtdGl0bGU9XCInK3RpdGxlVmFyKydcIj48c3BhbiBjbGFzcz1cImZvcm0tb3B0aW9uLXRvb2x0aXAgZi1zaXplLXRpbnkgZC1ub25lXCI+Jyt0aXRsZVZhcisnPC9zcGFuPjxzcGFuIGNsYXNzPVwiZm9ybS1vcHRpb24tdmFyaWFudCBmb3JtLW9wdGlvbi12YXJpYW50LS1jb2xvciBmb3JtLW9wdGlvbi12YXJpYW50LS1jb2xvcjJcIiB0aXRsZT1cIicrdGl0bGVWYXIrJ1wiPjxzcGFuIGNsYXNzPVwiZm9ybS1vcHRpb24tdmFyaWFudC13cmFwcGVyXCI+PHNwYW4gc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOicrY29sb3IxKydcIj48L3NwYW4+PHNwYW4gc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOicrY29sb3IyKydcIj48L3NwYW4+PHNwYW4gc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOicrY29sb3IzKydcIj48L3NwYW4+PC9zcGFuPjwvc3Bhbj48L2xhYmVsPicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKEJvb2xlYW4oY29sb3IxKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdEZpZWxkQ29sb3IuYXBwZW5kKCc8bGFiZWwgY2xhc3M9XCJmb3JtLW9wdGlvbiBmb3JtLW9wdGlvbi1zd2F0Y2ggaGFsby1mYWRlSW5cIiBkYXRhLWltYWdlID1cIicrdmFyaWFudEltYWdlKydcIiAgZGF0YS1wcm9kdWN0LXN3YXRjaC12YWx1ZT1cIicraWRWYXIrJ1wiIGRhdGEtdGl0bGU9XCInK3RpdGxlVmFyKydcIj48c3BhbiBjbGFzcz1cImZvcm0tb3B0aW9uLXRvb2x0aXAgZi1zaXplLXRpbnkgZC1ub25lXCI+Jyt0aXRsZVZhcisnPC9zcGFuPjxzcGFuIGNsYXNzPVwiZm9ybS1vcHRpb24tdmFyaWFudCBmb3JtLW9wdGlvbi12YXJpYW50LS1jb2xvclwiIHRpdGxlPVwiJyt0aXRsZVZhcisnXCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiAnK2NvbG9yMSsnXCI+PC9zcGFuPjwvbGFiZWw+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoQm9vbGVhbihpbWcpKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0RmllbGRDb2xvci5hcHBlbmQoJzxsYWJlbCBjbGFzcz1cImZvcm0tb3B0aW9uIGZvcm0tb3B0aW9uLXN3YXRjaCBoYWxvLWZhZGVJbiBcIiBkYXRhLWltYWdlID1cIicrdmFyaWFudEltYWdlKydcIiBkYXRhLXByb2R1Y3Qtc3dhdGNoLXZhbHVlPVwiJytpZFZhcisnXCIgZGF0YS10aXRsZT1cIicrdGl0bGVWYXIrJ1wiPjxzcGFuIGNsYXNzPVwiZm9ybS1vcHRpb24tdG9vbHRpcCBmLXNpemUtdGlueSBkLW5vbmVcIj4nK3RpdGxlVmFyKyc8L3NwYW4+PHNwYW4gY2xhc3M9XCJmb3JtLW9wdGlvbi12YXJpYW50IGZvcm0tb3B0aW9uLXZhcmlhbnQtLXBhdHRlcm5cIiB0aXRsZT1cIicrdGl0bGVWYXIrJ1wiIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCcraW1nKycpXCI+PC9zcGFuPjwvbGFiZWw+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RGaWVsZENvbG9yLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVuaXF1ZUFycmF5KGxpc3QpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG5cclxuICAgICAgICAgICAgJC5lYWNoKGxpc3QsIChpbmRleCwgZWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCQuaW5BcnJheShlbGVtZW50LCByZXN1bHQpID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNhbGxQcm9kdWN0T3B0aW9uKCk7XHJcblxyXG4gICAgICAgIHByb2R1Y3Rfd3JhcHBlci5vbignYmVmb3JlQ2hhbmdlJywgZnVuY3Rpb24gKCl7XHJcbiAgICAgICAgICAgIGNhbGxQcm9kdWN0T3B0aW9uKCk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufVxyXG4iXSwibmFtZXMiOlsiY29udGV4dCIsIndyYXBwZXIiLCJ0aGVtZVNldHRpbmdzIiwiaGFsb0FkZE9wdGlvbkZvclByb2R1Y3QiLCJjYWxsUHJvZHVjdE9wdGlvbiIsInByb2R1Y3RfY2xhc3MiLCJlYWNoIiwiaW5kZXgiLCJlbGVtZW50IiwicHJvZHVjdElkIiwiJCIsImRhdGEiLCJmaW5kIiwiY2hpbGRyZW4iLCJsZW5ndGgiLCJsaXN0IiwicHVzaCIsInRvU3RyaW5nIiwidW5pcXVlQXJyYXkiLCJnZXRQcm9kdWN0T3B0aW9uIiwidGhlbiIsInJlbmRlck9wdGlvbiIsImlkeCIsIml0ZW0iLCJhcnIiLCJ0aGlzUHJvZHVjdCIsInByb2R1Y3Rfd3JhcHBlciIsInR4dCIsInNob3ciLCJyZW1vdmUiLCJjb3VudE1vcmVPcHRpb24iLCJwcm9kdWN0TGluayIsImF0dHIiLCJhcHBlbmQiLCJhZGRDbGFzcyIsImNsb3Nlc3QiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJ0b2tlbiIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicXVlcnkiLCJyZXMiLCJqc29uIiwiYUZpbHRlciIsInNpdGUiLCJwcm9kdWN0cyIsImVkZ2VzIiwibm9kZSIsImVudGl0eUlkIiwicHJvZHVjdEltYWdlIiwicHJvZHVjdEZpZWxkQ29sb3IiLCJhRmlsdGVyMiIsInZhcmlhbnRzIiwiZGVmYXVsdEltYWdlIiwidXJsT3JpZ2luYWwiLCJlbCIsInZhcmlhbnRJbWFnZSIsImFGaWx0ZXIzIiwicHJvZHVjdE9wdGlvbnMiLCJ1bmRlZmluZWQiLCJhRmlsdGVyNCIsImZpbHRlciIsImRpc3BsYXlTdHlsZSIsImFGaWx0ZXI1IiwidmFsdWVzIiwidGl0bGVWYXIiLCJsYWJlbCIsImlkVmFyIiwibGVuZ3RoQ29sb3JWYXIiLCJoZXhDb2xvcnMiLCJjb2xvcjEiLCJjb2xvcjIiLCJjb2xvcjMiLCJpbWciLCJpbWFnZVVybCIsIkJvb2xlYW4iLCJyZXN1bHQiLCJpbkFycmF5Iiwib24iXSwic291cmNlUm9vdCI6IiJ9
